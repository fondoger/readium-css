<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="generator" content="pandoc"/>
  <title>Readium CSS Implementers’ doc</title>
  <link rel="stylesheet" type="text/css" href="../Styles/stylesheet.css"/>
</head>

<body xml:lang="en">
  <section id="migration-guide" class="level1">
    <h1>Migration Guide</h1>

    <p>[Implementers’ doc] [WIP]</p>

    <p>This document aims to list changes that were made in <code>v.2</code> and how to handle them in your Reading System/apps when upgrading ReadiumCSS.</p>

    <section id="removal-of-responsive-columns" class="level2">
      <h2 id="sigil_toc_id_191">Removal of responsive columns</h2>

      <p>In version 1, ReadiumCSS used media queries to automatically handle the number of columns/pages to display based on certains conditions. To sum things up it switched from 1 to 2 columns when:</p>

      <ul>
        <li>the <code>width</code> of the window was large enough, based on the font-size;</li>

        <li>the device’s width (<code>device-width</code>) was within an arbitrary range based on the font-size, and in landscape orientation.</li>
      </ul>

      <p>As a side-effect, this “auto-pagination model” (think of it as an “auto” setting for the number of columns/pages in user settings) was <a href="https://github.com/readium/readium-css/issues/143">not reliable enough for implementers</a>, and created issues with newer devices and form-factors (e.g.&#160;foldables). Sometimes it wouldn’t even swith to 2 columns when applying the setting because of the conditions above.</p>

      <p>In version 2, ReadiumCSS removed these media queries and the “auto-pagination model” entirely. It applies styles the Reading System/app provides to it. Consequently, control over breakpoints is now the responsibility of the app.</p>

      <p>If you want to reimplement an “auto” user setting, and switch to 1 or 2 columns depending on the orientation of the device or the width of the window, you now have to handle it programmatically.</p>
    </section>

    <section id="number-of-columns-is-no-longer-limited" class="level2">
      <h2 id="sigil_toc_id_192">Number of columns is no longer limited</h2>

      <p>In version 1, ReadiumCSS limited the number of columns to <code>1</code> or <code>2</code>.</p>

      <p>In version 2, the number of columns is no longer limited. Please note value <code>0</code> is handled as an error and resolves to <code>1</code> though.</p>
    </section>

    <section id="addition-of-a-flag-to-disable-vertical-writing-pagination" class="level2">
      <h2 id="sigil_toc_id_193">Addition of a flag to disable vertical-writing pagination</h2>

      <p>Given the limitations of columns fragmentation in vertical writing – progression direction from top to bottom instead of right to left, columns stacked on the <code>y-axis</code> –, some Reading Systems and apps have been disabling it, and implement their own logic.</p>

      <p>Since pagination is the default view, it is now possible to disable it by appending <code>--RS__disablePagination: readium-noVerticalPagination-on</code> on the <code>:root</code> (<code>html</code>) element.</p>
    </section>

    <section id="removal-of--webkit-perspective-hack-for-older-versions-of-chromium" class="level2">
      <h2 id="sigil_toc_id_194">Removal of -webkit-perspective hack for older versions of Chromium</h2>

      <p>The following hack was used in version 1:</p>

      <pre><code>:root { -webkit-perspective: 1; }</code></pre>

      <p>The issues it resolves are described in <a href="https://caniuse.com/multicolumn#bugs">CanIUse’s “known issues” for CSS Multicolumn</a>:</p>

      <blockquote>
        <p>Chrome is reported to incorrectly calculate the container height, often breaks on margins and padding, and can display one pixel of the next column at the bottom of the previous column. Some of these issues can be solved by adding <code>-webkit-perspective: 1;</code> to the column container. This creates a new stacking context for the container, and apparently causes Chrome to (re)calculate column layout.</p>
      </blockquote>

      <p>That hack created a <a href="https://github.com/readium/readium-css/issues/117">performance issue for large HTML documents</a> as a side-effect though, and it was consequently removed in version 2, especially as it was no longer needed.</p>

      <p>Blink/Chromium switched to their new LayoutNG for columns in version <code>v.106.0.5245.0</code>. This means that if you have to deal with versions below, you have to re-implement this CSS hack specifically for these – and their older layout engine.</p>

      <p>It could be something as simple as appending the style to the <code>html</code> element:</p>

      <pre><code>&lt;html style="-webkit-perspective: 1"&gt;</code></pre>

      <p>or adding it in <code>head</code>:</p>

      <pre><code>&lt;head&gt; ... &lt;style type="text/css"&gt; :root { -webkit-perspective: 1; } &lt;/style&gt; ... &lt;/head&gt;</code></pre>
    </section>

    <section id="replacement-of-page-margins-user-setting-with-line-length-user-setting" class="level2">
      <h2 id="sigil_toc_id_195">Replacement of page margins user setting with line length user setting</h2>

      <p>In version 1 ReadiumCSS implemented a page margins user setting: <code>--USER__pageMargins</code>.</p>

      <p>This is no longer supported in version 2, as it has been replaced with a user setting for the line length of body copy (i.e.&#160;the <code>max-width</code> of the <code>body</code> element). <code>--USER__lineLength</code> should now be used.</p>

      <p>The user setting should consequently be updated, either in the form of replacement or mimicking of the old one.</p>

      <p>It is indeed possible to re-implement the page margins user setting by using the new variable, given margin will adjust automatically to the line length, but this also means that your updated logic will have to work backwards.</p>

      <p>Otherwise, the line-length user setting can be a set of predefined values, a range, etc. It accepts the values that the CSS properties <code>max-width|height</code> do.</p>

      <p>As a side effect, <code>--RS__pageGutter</code> is now set to <code>0</code> as default. This means no <code>padding</code> is applied to neither the <code>:root</code> nor <code>body</code> elements. This is to make sure ReadiumCSS gives you what you expect when applying the setting, w/o anything creating inconsistencies and unreliabilities.</p>

      <p>You can set the value yourself so that you are aware of it, or design the setting logic around it.</p>

      <p>This setting will be applied in all conditions (1 or 2-col pagination, scroll) so you might want to make sure it can work for all three, and maybe adjust the values accordingly.</p>
    </section>

    <section id="extension-of-the-font-family-user-setting-override" class="level2">
      <h2 id="sigil_toc_id_196">Extension of the font-family user setting override</h2>

      <p>In version 1, the font-family user setting overrode a selection of elements of body copy e.g. <code>p</code>, <code>li</code>, <code>dt</code>, etc. This explained why the font-family of headings would remain the same as the one set in authors’ stylesheets for instance.</p>

      <p>In version 2, the logic has changed and the override will now apply to everything except a handful of tags e.g. <code>code</code>, <code>var</code>, <code>samp</code>, and <code>kbd</code>. It is actually borrowed from the accessibility fonts and normalization module.</p>
    </section>
  </section>
</body>
</html>